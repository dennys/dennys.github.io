<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>Dennys Diary</title>
        <link>https://dennys.github.io/</link>
        <description>Dennys Diary</description>
        <generator>Hugo -- gohugo.io</generator><language>en</language><copyright>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</copyright><lastBuildDate>Sat, 11 Jun 2022 22:18:32 &#43;0800</lastBuildDate>
            <atom:link href="https://dennys.github.io/index.xml" rel="self" type="application/rss+xml" />
        <item>
    <title>更新 Unlock 過的 Pixel 5</title>
    <link>https://dennys.github.io/202206/update-unlocked-pixel5/</link>
    <pubDate>Thu, 02 Jun 2022 22:18:32 &#43;0800</pubDate>
    <author>Dennys</author>
    <guid>https://dennys.github.io/202206/update-unlocked-pixel5/</guid>
    <description><![CDATA[<h2 id="前言">前言</h2>
<p>Pixel 5 在 Unlock 之後, 自動更新就失效了, 得手動更新, 方法如下.</p>
<h2 id="事前準備">事前準備</h2>
<ol>
<li>下載
<ol>
<li><a href="https://developers.google.com/android/ota" target="_blank" rel="noopener noreffer">Pixel OTA Images</a></li>
<li><a href="https://developers.google.com/android/images" target="_blank" rel="noopener noreffer">Pixel Factory Images</a></li>
</ol>
</li>
<li>把redfin-sq1a.220205.002-factory-734556ab.zip (檔案名稱看實際的版本) 解壓縮, 要解兩層, 直到解出 boot.img</li>
<li>利用 Magisk 修補 boot.img, 產生的檔案名稱長類似這樣 magisk_patched-24201_LSQ4E.img, 再把這個檔案傳回電腦中</li>
<li>進入開發者模式並確定 adb devices 可以連</li>
</ol>
<p><a href="https://dennys.files.wordpress.com/2022/01/auth.jpg"></a>
<br></p>
<h2 id="更新步驟">更新步驟</h2>
<ol>
<li>
<p>執行以下指令重新開機進入sideload mode</p>
<p><code>adb reboot sideload</code></p>
</li>
<li>
<p>刷入安全性更新檔案, 這個步驟會比較久</p>
<p><code>adb sideload redfin-ota-sq1a.220205.002-84ba2421.zip</code></p>
</li>
<li>
<p>完成上傳後<strong><mark style="background-color:rgba(0, 0, 0, 0);" class="has-inline-color has-vivid-red-color">勿重新開機，&ldquo;在手機上&rdquo; 選擇Reboot to bootloader</mark></strong></p>
</li>
<li>
<p>刷入被 Magisk 修補後的 boot.img</p>
<p><code>fastboot flash boot --slot=all magisk_patched-24201_LSQ4E.img</code></p>
</li>
<li>
<p>執行以下指令重新開機</p>
<p><code>fastboot reboot</code></p>
</li>
<li>
<p>進入 設定-&gt;關於-&gt;Android 版本, 確定有更新成功.</li></ol></p>
</li>
</ol>
<h2 id="參考">參考</h2>
<ol>
<li><a href="https://forum.xda-developers.com/t/4356219/" target="_blank" rel="noopener noreffer">https://forum.xda-developers.com/t/4356219/</a></li>
<li><a href="https://www.mobile01.com/topicdetail.php?f=565&amp;t=6487485" target="_blank" rel="noopener noreffer">https://www.mobile01.com/topicdetail.php?f=565&t=6487485</a></li>
</ol>
]]></description>
</item>
<item>
    <title>如何下載 YouTube 私人影片 (使用 youtube-dl 或 ytl-dp)</title>
    <link>https://dennys.github.io/202206/download-youtube-private-video/</link>
    <pubDate>Thu, 02 Jun 2022 10:18:32 &#43;0800</pubDate>
    <author>Dennys</author>
    <guid>https://dennys.github.io/202206/download-youtube-private-video/</guid>
    <description><![CDATA[<h2 id="需求">需求</h2>
<p>YouTube 預設是不能讓人下載影片的, 即使是你自己上傳的影片也是一樣. 然後我的影片大多都設成私人, 就更沒辦法用一堆線上工具下載了. 研究了一下兩年前曾被 GitHub 下架的 youtube-dl, 看來他支援下載私人影片 (不需要帳號密碼, 用 cookie).</p>
<h2 id="工具準備">工具準備</h2>
<h3 id="需要以下幾樣工具">需要以下幾樣工具</h3>
<ol>
<li><a href="https://github.com/ytdl-org/youtube-dl" target="_blank" rel="noopener noreffer">youtube-dl</a> 或是 <a href="https://github.com/yt-dlp/yt-dlp" target="_blank" rel="noopener noreffer">ytl-dp</a></li>
<li>cookie 工具, 我是用 <a href="https://chrome.google.com/webstore/detail/get-cookiestxt/bgaddhkoddajcdgocldbbfleckgcbcid" target="_blank" rel="noopener noreffer">Get cookies.txt</a> 這個 Chrome extension</li>
<li><a href="https://www.ffmpeg.org/download.html" target="_blank" rel="noopener noreffer">FFmpeg</a>, 轉檔用</li>
</ol>
<h2>1. 準備 cookie</h2>
<p>既然這是私人影片, 就會卡權限, 因此要準備 cookie. (注意: 這個套件不會去抓無痕模式的 cookie). 安裝好後, 連上 youtube.com, 然後 export 檔案出來就好. 預設他取的名字會是 youtube.com_cookies.txt, 這邊就不修改檔案名稱.</p>
<p><a href="https://dennys.files.wordpress.com/2022/05/image-14.png"></a></p>
<h2>2. 使用 youtube-dl 下載</h2>
<p>使用如下指令就可以下載檔案了</p>
<pre class="wp-block-code"><code>youtube-dl.exe --format bestvideo+bestaudio --limit-rate 2M --cookies=youtube.com_cookies.txt https://www.youtube.com/watch?v=********/</code></pre>
<p>要注意的是, 如果沒有 FFmpeg, youtube-dl 就不會合併檔案, 最後就會有一個影片(mp4), 一個聲音 (m4a), 得要再另外 merge, 很麻煩, 如下圖.</p>
<p><a href="https://dennys.files.wordpress.com/2022/05/image-12.png"></a></p>
<p>因此, 直接在下載參數指定 FFmpeg 的目錄位置, 這樣在下載完後, 他就會去呼叫 FFmpeg 執行合併檔案的動作.</p>
<pre class="wp-block-code"><code>youtube-dl.exe <mark style="background-color:rgba(0, 0, 0, 0);" class="has-inline-color has-vivid-red-color">--ffmpeg-location C:\bin\ffmpeg\bin</mark> --format bestvideo+bestaudio --limit-rate 2M --cookies=youtube.com_cookies.txt https://www.youtube.com/watch?v=********/</code></pre>
<p>如下, 他會把 mp4/m4a 合併成一個 mp4 檔案, 然後把原來的檔案刪除.</p>
<p><a href="https://dennys.files.wordpress.com/2022/05/image-11.png"></a></p>
<h2>3. 使用 youtube-dl 下載</h2>
<p><a href="https://github.com/yt-dlp/yt-dlp" target="_blank" rel="noopener noreffer">YT-DLP</a> 是 youtube-dl 的一個 fork, 他自己的官方說明是 &ldquo;A youtube-dl fork with additional features and fixes&rdquo;, 兩者的指令也都差不多, 試用了一下也沒甚麼問題, 只是下載完是 .mkv</p>
<p><a href="https://dennys.files.wordpress.com/2022/05/image-13.png"></a></p>
]]></description>
</item>
<item>
    <title>無聲遠端桌面連線 - VNC</title>
    <link>https://dennys.github.io/202206/realvnc/</link>
    <pubDate>Thu, 02 Jun 2022 10:18:32 &#43;0800</pubDate>
    <author>Dennys</author>
    <guid>https://dennys.github.io/202206/realvnc/</guid>
    <description><![CDATA[<h2 id="需求">需求</h2>
<p>要做一個遠端登入的功能, 而且需要做到以下幾項</p>
<ol>
<li>進去的時候不能有任何跳出的畫面, 就是不讓使用者有感覺的意思</li>
<li>進去的時候, 預設是只有 &ldquo;看&rdquo; 而不能控制滑鼠鍵盤, 同樣也是不讓使用者有感覺</li>
<li>有需要的話, 可以切換一下, 就可以控制滑鼠鍵盤了</li>
</ol>
<h2 id="步驟-server-端">步驟 (Server 端)</h2>
<p>先把 show accept/reject prompt for each connection 關掉, 這樣連線上去時就不會跳一個視窗出來問是否同意連線.</p>
<p><a href="https://dennys.files.wordpress.com/2022/06/image-3.png"></a>
<br></p>
<p>再關掉 Notify when users connect and disconnect, 這樣連線時就不會跳出視窗. 另外, 預設是如果一段時間沒動作, 就會自動斷線. 如果不希望這樣, 可以把 Disconnect users who have been idle for an extended period 取消, 這樣就算放一整天也不會斷線. (也可以在 Expert 裡面設定 idleTimeout 時間)</p>
<p><a href="https://dennys.files.wordpress.com/2022/06/image-4.png"></a>
<br></p>
<p>如果沒有關掉, 那有人連上來時, 就會跳出這個視窗, 就被發現了. 😋</p>
<p><a href="https://dennys.files.wordpress.com/2022/06/image-5.png"></a>
<br></p>
<h2 id="步驟-client-端">步驟 (Client 端)</h2>
<p>在連線以前, 把 Option 裡面的 View-only 打開, 這樣你連上去的時候, 就不會去動到對方的滑鼠.</p>
<p><a href="https://dennys.files.wordpress.com/2022/06/image-7.png"></a>
<br></p>
<h2 id="成果">成果</h2>
<p>依照以上設定好, 就可以神不知鬼不覺得連到對方電腦了. 當然, 對方如果進去 VNC 看, 還是可以看到有誰連進來, 這個就沒招了.</p>
<p><a href="https://dennys.files.wordpress.com/2022/06/image-8.png"></a>
<br></p>
<h2 id="如果臨時想去移動對方的鍵盤滑鼠怎麼辦">如果臨時想去移動對方的鍵盤滑鼠怎麼辦?</h2>
<p>很簡單, VNC 的工具列可以改設定, 直接把 View-only 拿掉就可以了.</p>
<p><a href="https://dennys.files.wordpress.com/2022/06/image-9.png"></a></p>
]]></description>
</item>
<item>
    <title>在 Asuswrt-Merlin 使用 OpenVPN server</title>
    <link>https://dennys.github.io/202206/asuswrt-merlin-openvpn-server/</link>
    <pubDate>Wed, 01 Jun 2022 22:18:32 &#43;0800</pubDate>
    <author>Dennys</author>
    <guid>https://dennys.github.io/202206/asuswrt-merlin-openvpn-server/</guid>
    <description><![CDATA[<h2 id="asuswrt-merlin-的-vpn-方案">Asuswrt-Merlin 的 VPN 方案</h2>
<p><a href="https://www.asuswrt-merlin.net/" target="_blank" rel="noopener noreffer">Asuswrt-Merlin</a> 提供兩種 VPN server 工具, <a href="https://zh.m.wikipedia.org/zh-tw/%E9%BB%9E%E5%B0%8D%E9%BB%9E%E9%9A%A7%E9%81%93%E5%8D%94%E8%AD%B0" target="_blank" rel="noopener noreffer">PPTP</a> 和 <a href="https://zh.wikipedia.org/zh-tw/OpenVPN" target="_blank" rel="noopener noreffer">OpenVPN</a>. PPTP 看起來已經被淘汰, 連 <a href="https://support.apple.com/zh-tw/HT206844" target="_blank" rel="noopener noreffer">iOS 10 以上都不支援 PPTP</a> 了.  因此目前看來是只能用 OpenVPN.</p>
<p>註1: Asuswrt 官方原版似乎有提供 PPTP, OpenVPN, IPSec VPN 這三種 VPN server, 可參考 <a href="https://www.asus.com/tw/support/FAQ/1044190/" target="_blank" rel="noopener noreffer">https://www.asus.com/tw/support/FAQ/1044190/</a>, 不過我已經刷 Asuswrt-Merlin 了, 就不測試了.</p>
<h2 id="測試平台">測試平台</h2>
<ul>
<li>Asus RC-AC66U B1</li>
<li>Asuswrt-Merlin 386.5 (這個版本的 OpenVPN 是 2.5.5)</li>
</ul>
<h2 id="openvpn-server-設定-在-asuswrt-merlin">OpenVPN server 設定 (在 Asuswrt-Merlin)</h2>
<h3 id="1-openvpn-server-一般設定">1. OpenVPN server 一般設定</h3>
<p>首先進入 VPN 伺服器, 他可以建立兩個 OpenVPN server, 預設是 Server 1, 把它開啟. 我的需求是只有要透過 VPN 來連內網的電腦, 沒有要再連出去 Internet, 所以設定 &ldquo;LAN only&rdquo;. 另外, 如果需要使用者輸入帳號密碼, 請在最後面新增一個 username.</p>
<p><a href="https://dennys.files.wordpress.com/2022/06/image-10.png"></a>
<br></p>
<h3 id="2-openvpn-server-進階設定">2. OpenVPN server 進階設定</h3>
<p>再來是設定其他的細節, 先在下拉式選單這裡選 &ldquo;進階設定&rdquo;</p>
<p><a href="https://dennys.files.wordpress.com/2022/06/image-11.png"></a>
<br></p>
<p>進階設定內容如下, 如果希望 user 在 login 的時候要輸入帳號密碼, 那 &ldquo;Username/Password Authentication 就需要選 &ldquo;是&rdquo;.</p>
<p><a href="https://dennys.files.wordpress.com/2022/06/image-13.png"></a>
<br></p>
<p>設定好後, 請再回到一般設定, 然後把設定值輸出到成一個 .opvn 檔案.</p>
<p><a href="https://dennys.files.wordpress.com/2022/06/image-14.png"></a>
<br></p>
<p>要注意的是, Asuswrt-Merlin 產生的 client1.ovpn 裡面給的是 IP, 如果你用的不是固定 IP, 而是使用 <a href="https://www.asus.com/tw/support/FAQ/1011725/" target="_blank" rel="noopener noreffer">DDNS</a> 之類的, 請記得修改裡面 remote 後面的 IP. 下面是 DDNS 的設定</p>
<p><a href="https://dennys.files.wordpress.com/2022/06/image-18.png"></a>
<br></p>
<p>以這個例子來講, 請注意我這邊要自己修改 remote 後面的 test12345.asuscomm.com</p>
<pre><code># Config generated by Asuswrt-Merlin 386.5, requires OpenVPN 2.4.0 or newer.

client
dev tun
proto udp
remote test12345.asuscomm.com 1194
resolv-retry infinite
nobind
float
ncp-ciphers AES-128-GCM:AES-256-GCM:AES-128-CBC:AES-256-CBC
comp-lzo adaptive
keepalive 15 60
remote-cert-tls server
</code></pre>
<br>
<h2 id="openvpn-client-for-windows">OpenVPN Client for Windows</h2>
<p>從這裡下載: <a href="https://openvpn.net/community-downloads/" target="_blank" rel="noopener noreffer">https://openvpn.net/community-downloads/</a>, 裝好後選 import -&gt; 匯入設定檔, 把上面的檔案輸入進去, 就可以使用了.
<br><br></p>
<h2 id="openvpn-client-for-android">OpenVPN Client for Android</h2>
<p>從這裡下載: <a href="https://play.google.com/store/apps/details?id=net.openvpn.openvpn" target="_blank" rel="noopener noreffer">https://play.google.com/store/apps/details?id=net.openvpn.openvpn</a></p>
<p>連線成功後, 會出現這樣的通知, 可以直接在通知的地方暫停或斷線, 還滿方便的.</p>
<p><a href="https://dennys.files.wordpress.com/2022/06/image-15.png"></a></p>
<p>App 本身也會顯示使用的網路狀況</p>
<p><a href="https://dennys.files.wordpress.com/2022/06/image-16.png"></a>
<br><br></p>
<h2 id="openvpn-client-for-ios-macos-linux">OpenVPN Client for iOS, MacOS, Linux</h2>
<p>可在<a href="https://openvpn.net/download-open-vpn/">這裡</a>下載其他平台的 client.
<br><br></p>
<h2 id="openvpn-server-上的連線狀況">OpenVPN Server 上的連線狀況</h2>
<p>從這裡可以看出他有幾個 client, 實際和VPN的IP, 從甚麼時候連的, 使用的資料量等等.</p>
<p><a href="https://dennys.files.wordpress.com/2022/06/image-17.png"></a>
<br></p>
<h2 id="softether-vpn">SoftEther VPN</h2>
<p><a href="https://www.softether.org/">SoftEther VPN</a> 的官方文件說明他是 <em>An Open-Source Free ​Cross-platform Multi-protocol VPN Program</em>, 是看到有些人說他的 GUI 比 OpenVPN 好用, 但我用 OpenVPN 一切順利, 就懶得試了.
<br><br></p>
<h2 id="asuswrt-openvpn-還不足的地方">Asuswrt OpenVPN 還不足的地方</h2>
<p>感覺這還是比較陽春的 VPN server, 想到幾個不足的地方, 不過個人使用綽綽有餘了.</p>
<ol>
<li>沒有 timeout 機制, 連上來了就不會斷線.</li>
<li>沒法限制 client 個數 (可能可以用 DHCP IP 數量來卡), Synology 的 OpenVPN 可以卡.</li>
<li>管理介面沒法把人踢掉</li>
</ol>
]]></description>
</item>
<item>
    <title>如何設定 Android 零打擾的時間長度</title>
    <link>https://dennys.github.io/202205/android-do-not-disturb/</link>
    <pubDate>Mon, 23 May 2022 10:18:32 &#43;0800</pubDate>
    <author>Dennys</author>
    <guid>https://dennys.github.io/202205/android-do-not-disturb/</guid>
    <description><![CDATA[<h2 id="需求">需求</h2>
<p>Android 可以從快速設定來開關零打擾, 但預設只能開和關, 常常開了後就忘了關了.</p>
<p><a href="https://dennys.files.wordpress.com/2022/05/image-8.png"></a></p>
<h2 id="作法">作法</h2>
<p>如果要調整零打擾的長度, 可從這裡修改: 設定 -&gt; 通知 -&gt; 零打擾 -&gt; 從快速設定開啟時的持續時間長度</p>
<p><a href="https://dennys.files.wordpress.com/2022/05/image-2.png"></a></p>
<p>預設值是&quot;直到你關閉為止&quot;, 因此他就只能開和關. 我是把它改成&quot;每次都詢問&quot;</p>
<p><a href="https://dennys.files.wordpress.com/2022/05/image-3.png"></a></p>
<p>改過之後再看快速設定, 右邊就多了一個箭頭, 按下去就會有選項</p>
<p><a href="https://dennys.files.wordpress.com/2022/05/image-7.png"></a></p>
<h2 id="結果">結果</h2>
<p>這裡就可以設定你要零打擾的時間長度 (以小時為單位), 或是直接指定時間.</p>
<p><a href="https://dennys.files.wordpress.com/2022/05/image-4.png"></a></p>
]]></description>
</item>
<item>
    <title>Google Maps 音樂接藍牙, 語音不接</title>
    <link>https://dennys.github.io/202204/google-maps-bluetooth-voice-music/</link>
    <pubDate>Wed, 20 Apr 2022 10:18:32 &#43;0800</pubDate>
    <author>Dennys</author>
    <guid>https://dennys.github.io/202204/google-maps-bluetooth-voice-music/</guid>
    <description><![CDATA[<h2 id="需求">需求</h2>
<p>不知道為甚麼, 手機接一般藍牙喇叭都不會延遲, 但接車機藍牙就會延遲, 而且延遲時間會愈來愈長. 聽音樂是還好, 但是導航語音延遲太長就是個問題了, 可能地方都過了才聽到聲音.</p>
<h2 id="作法">作法</h2>
<p>後來找到的解法是, 設定不要&quot;透過藍牙撥放語音&quot;, 這樣就可以了. 當有導航時, 車上的音樂 (從手機的藍牙過來) 會暫停, 然後導航語音是直接從手機出來. 要注意的是, 導航音量可能要調大聲一點.</p>
<p><a href="https://dennys.files.wordpress.com/2022/04/image-8.png"></a></p>
]]></description>
</item>
<item>
    <title>將 Gmail 的通知改成可以直接刪除</title>
    <link>https://dennys.github.io/202204/gmail-notify-delete-archive/</link>
    <pubDate>Wed, 20 Apr 2022 10:18:32 &#43;0800</pubDate>
    <author>Dennys</author>
    <guid>https://dennys.github.io/202204/gmail-notify-delete-archive/</guid>
    <description><![CDATA[<h2 id="需求">需求</h2>
<p>Gmail 的通知, 預設是可以在通知的地方選&quot;封存&quot;或&quot;回覆&quot;, 但其實可以修改.</p>
<p><a href="https://dennys.files.wordpress.com/2022/04/image-6.png"></a></p>
<h2 id="作法">作法</h2>
<p>打開 Gmail App, 進入一般設定, 修改預設的電子郵件通知動作, 預設是&quot;封存&quot;, 把它改成刪除.</p>
<p><a href="https://dennys.files.wordpress.com/2022/02/image-10.png"></a></p>
<p>修改完後, 就可以在收到 Gmail 通知時, 直接刪除信件.</p>
<p><a href="https://dennys.files.wordpress.com/2022/04/image-7.png"></a></p>
<h2 id="後記">後記</h2>
<p>如果可以讓封存和刪除都出來就更好了.</p>
]]></description>
</item>
<item>
    <title>把 Android 12 鎖定畫面的時鐘改單行</title>
    <link>https://dennys.github.io/202204/android-12-lock-screen-double-line-clock/</link>
    <pubDate>Sun, 10 Apr 2022 00:18:32 &#43;0800</pubDate>
    <author>Dennys</author>
    <guid>https://dennys.github.io/202204/android-12-lock-screen-double-line-clock/</guid>
    <description><![CDATA[<h2 id="前言">前言</h2>
<p>自 Android 12 開始, 鎖定畫面的時鐘變成兩列, 而且無法更改.</p>
<p><a href="https://dennys.files.wordpress.com/2022/04/image-1.png"></a></p>
<p>看起來<a href="https://support.google.com/pixelphone/thread/133395984/">評價</a>不是很好, 我也覺得很不直覺&hellip;</p>
<p><a href="https://dennys.files.wordpress.com/2022/04/image-3.png"></a></p>
<p>不過自 2022年3月更新後, 新增了一個選項, 可以取消雙行時鐘了.</p>
<p><a href="https://dennys.files.wordpress.com/2022/03/image-12.png"></a></p>
<h2 id="成果">成果</h2>
<p>結果就會變成如下</p>
<p><a href="https://dennys.files.wordpress.com/2022/04/image-2.png"></a></p>
<h2 id="參考">參考:</h2>
<ol>
<li>Google Pixel Update - March 2022(<a href="https://support.google.com/pixelphone/thread/153884074/google-pixel-update-march-2022" target="_blank" rel="noopener noreffer">https://support.google.com/pixelphone/thread/153884074/google-pixel-update-march-2022</a>) (奇怪的是, 官方的 3 月更新 list 並沒有提到這點.)</li>
<li>Google community 的說明: <a href="https://support.google.com/pixelphone/thread/133395984?hl=en&amp;msgid=154180966" target="_blank" rel="noopener noreffer">https://support.google.com/pixelphone/thread/133395984?hl=en&msgid=154180966</a></li>
</ol>
]]></description>
</item>
<item>
    <title>Android 11 如何不要驗證 Wi-Fi CA 憑證</title>
    <link>https://dennys.github.io/202203/add-do-not-validate-android-11-peap-mschapv2-wifi/</link>
    <pubDate>Fri, 25 Mar 2022 00:00:00 &#43;0800</pubDate>
    <author>Dennys</author>
    <guid>https://dennys.github.io/202203/add-do-not-validate-android-11-peap-mschapv2-wifi/</guid>
    <description><![CDATA[<p><mark style="background-color:rgba(0,0,0,0);" class="has-inline-color has-vivid-red-color"><strong>注意: 系統刷機有一定的風險, 可能導致手機無法開機和失去保固, 資料還會被清空, 執行前請先三思!!!</strong></mark></p>
<p><strong><mark style="background-color:rgba(0,0,0,0);" class="has-inline-color has-luminous-vivid-amber-color">注意: 系統刷機有一定的風險, 可能導致手機無法開機和失去保固, 資料還會被清空, 執行前請先三思!!!</mark></strong></p>
<p><strong><mark style="background-color:rgba(0,0,0,0);" class="has-inline-color has-luminous-vivid-orange-color">注意: 系統刷機有一定的風險, 可能導致手機無法開機和失去保固, 資料還會被清空, 執行前請先三思!!!</mark></strong></p>
<p>======================================================</p>
<h2 id="更新紀錄">更新紀錄</h2>
<ol>
<li>2022/05/30: 新增系統更新或 Wi-Fi 密碼修改後的處理方式</li>
</ol>
<h2 id="wi-fi-ca-憑證驗證在-android-11-的改變">Wi-Fi CA 憑證驗證在 Android 11 的改變</h2>
<p>Android 10 以前, 如果是連到 Enterprise Wi-Fi (EAP/PEAP), CA 憑證是可以選 &ldquo;不要驗證&rdquo;, 如下:</p>
<p><a href="https://dennys.files.wordpress.com/2022/02/image-13.png"></a></p>
<p>自 Android 11 起, 如果是連到 Enterprise Wi-Fi (PEAP), CA 憑證就無法選 &ldquo;不要驗證&rdquo;, 原因可參考 <a href="https://www.xda-developers.com/android-11-break-enterprise-wifi-connection/" target="_blank" rel="noopener noreffer">https://www.xda-developers.com/android-11-break-enterprise-wifi-connection/</a>. 這個方向是對的, 但如果網管不改, 一般使用者恐怕也無能為力. (<mark style="background-color:rgba(0, 0, 0, 0);" class="has-inline-color has-vivid-red-color">而且 iPhone 至少到 15.4 都沒有卡這個&hellip;</mark>)</p>
<p>爬了一下文, 看來是可以直接把這個設定加回去 (參考: <a href="https://android.stackexchange.com/questions/231859/%29" target="_blank" rel="noopener noreffer">https://android.stackexchange.com/questions/231859/)</a>, 但很不幸的, 檔案是放在 /data/misc/apexdata/com.android.wifi/WifiConfigStore.xm, 這裡的檔案<mark style="background-color:rgba(0, 0, 0, 0);" class="has-inline-color has-vivid-red-color">必須 Unlock 才能修改</mark>. 文章裡面是寫有可能透過 App 修改, 但我沒找到方法, 如果有人找到好方法了, 也麻煩分享一下.</p>
<h2 id="修改步驟">修改步驟</h2>
<ol>
<li>
<p>首先, 要 Unlock, Pixel 5 (Android 12) 可參考 <a href="https://dennys.github.io/zh-tw/2022/03/google-pixel-5-root-magisk" target="_blank" rel="noopener noreffer">https://dennys.github.io/zh-tw/2022/03/google-pixel-5-root-magisk</a>. (要做到把 boot.img 換掉)</p>
</li>
<li>
<p>試著連上 Wi-Fi, 網域就隨便給他寫, 然後試著連線, 這<mark style="background-color:rgba(0, 0, 0, 0);" class="has-inline-color has-vivid-red-color">當然是不會成功</mark>, 目的只是要先寫入一版 Config 檔案, 等一下可以修改.</p></p>
</li>
</ol>
<p><a href="https://dennys.files.wordpress.com/2022/02/1-1.png"></a></p>
<ol start="3">
<li>先用下列指令檢查 WifiConfigStore.xml 是否正確, 這裡也可以用 adb pull 拉到電腦檢查, 但我一直沒成功, 就先用 cat 看. 若執行時發生</p></li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">adb shell
</span></span><span class="line"><span class="cl">su
</span></span><span class="line"><span class="cl">cat /data/misc/apexdata/com.android.wifi/WifiConfigStore.xml
</span></span></code></pre></td></tr></table>
</div>
</div><p>若執行 su 時發生 inaccessible or not found (如下), 通常是 root 沒成功, 請再確認一次 root 步驟.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">127|redfin:/system/bin $ su
</span></span><span class="line"><span class="cl">/system/bin/sh: su: inaccessible or not found
</span></span></code></pre></td></tr></table>
</div>
</div><p>讀出來的 WifiConfigStore.xml 內容如下, 可找 WifiEnterpriseConfiguration 這個關鍵字, 目的是要把紅色的設定值拿掉</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;WifiEnterpriseConfiguration&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;Identity&#34;&gt;這裡是帳號名字&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;AnonIdentity&#34;&gt;&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;Password&#34;&gt;這裡是密碼&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;ClientCert&#34;&gt;&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;CaCert&#34;&gt;&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;SubjectMatch&#34;&gt;&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;Engine&#34;&gt;0&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;EngineId&#34;&gt;&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;PrivateKeyId&#34;&gt;&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;AltSubjectMatch&#34;&gt;&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;DomSuffixMatch&#34;&gt;這裡是上面隨便輸入的網域&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;CaPath&#34;&gt;/system/etc/security/cacerts&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;int name=&#34;EapMethod&#34; value=&#34;0&#34; /&gt;
</span></span><span class="line"><span class="cl">&lt;int name=&#34;Phase2Method&#34; value=&#34;4&#34; /&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;PLMN&#34;&gt;&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;Realm&#34;&gt;&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;int name=&#34;Ocsp&#34; value=&#34;0&#34; /&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;WapiCertSuite&#34;&gt;&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;boolean name=&#34;AppInstalledRootCaCert&#34; value=&#34;false&#34; /&gt;
</span></span><span class="line"><span class="cl">&lt;boolean name=&#34;AppInstalledPrivateKey&#34; value=&#34;false&#34; /&gt;
</span></span><span class="line"><span class="cl">&lt;null name=&#34;KeyChainAlias&#34; /&gt;
</span></span><span class="line"><span class="cl">&lt;null name=&#34;DecoratedIdentityPrefix&#34; /&gt;
</span></span><span class="line"><span class="cl">&lt;/WifiEnterpriseConfiguration&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>執行以下指令 (這指令是直接從上面那篇 stackexchange 抄過來的), 他就會把 <code>CaPath</code> 和 <code>DomSuffixMatch</code> 的內容改成空白. 最後一個步驟會重開, <em><strong>要重開才會生效</strong></em>.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">adb shell
</span></span><span class="line"><span class="cl">su
</span></span><span class="line"><span class="cl">sed -i &#39;s%&amp;lt;string name=&#34;CaPath&#34;&amp;gt;.*&amp;lt;/string&amp;gt;%&amp;lt;string name=&#34;CaPath&#34;&amp;gt;&amp;lt;/string&amp;gt;%&#39; /data/misc/apexdata/com.android.wifi/WifiConfigStore.xml
</span></span><span class="line"><span class="cl">sed -i &#39;s%&amp;lt;string name=&#34;DomSuffixMatch&#34;&amp;gt;.*&amp;lt;/string&amp;gt;%&amp;lt;string name=&#34;DomSuffixMatch&#34;&amp;gt;&amp;lt;/string&amp;gt;%&#39; /data/misc/apexdata/com.android.wifi/WifiConfigStore.xml
</span></span><span class="line"><span class="cl">reboot
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="5">
<li>重開完後, 檢查 <code>/data/misc/apexdata/com.android.wifi/WifiConfigStore.xml</code> 的內容, 確認下面紅色這段的設定被清空了</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;WifiEnterpriseConfiguration&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;Identity&#34;&gt;這裡是帳號名字&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;AnonIdentity&#34;&gt;&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;Password&#34;&gt;這裡是密碼&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;ClientCert&#34;&gt;&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;CaCert&#34;&gt;&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;SubjectMatch&#34;&gt;&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;Engine&#34;&gt;0&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;EngineId&#34;&gt;&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;PrivateKeyId&#34;&gt;&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;AltSubjectMatch&#34;&gt;&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;DomSuffixMatch&#34;&gt;&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;CaPath&#34;&gt;&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;int name=&#34;EapMethod&#34; value=&#34;0&#34; /&gt;
</span></span><span class="line"><span class="cl">&lt;int name=&#34;Phase2Method&#34; value=&#34;4&#34; /&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;PLMN&#34;&gt;&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;Realm&#34;&gt;&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;int name=&#34;Ocsp&#34; value=&#34;0&#34; /&gt;
</span></span><span class="line"><span class="cl">&lt;string name=&#34;WapiCertSuite&#34;&gt;&lt;/string&gt;
</span></span><span class="line"><span class="cl">&lt;boolean name=&#34;AppInstalledRootCaCert&#34; value=&#34;false&#34; /&gt;
</span></span><span class="line"><span class="cl">&lt;boolean name=&#34;AppInstalledPrivateKey&#34; value=&#34;false&#34; /&gt;
</span></span><span class="line"><span class="cl">&lt;null name=&#34;KeyChainAlias&#34; /&gt;
</span></span><span class="line"><span class="cl">&lt;null name=&#34;DecoratedIdentityPrefix&#34; /&gt;
</span></span><span class="line"><span class="cl">&lt;/WifiEnterpriseConfiguration&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="6">
<li>
<p>這時候應該就可以連線了</p>
</li>
<li>
<p>因為實際上並不需要 root, 只是為了修改 WifiConfigStore.xml, 因此改完後可以 UnRoot (移除 Magisk 和刷回原廠 boot.img), 但因為解鎖會清空資料, 而且下次又遇到新的 Wi-Fi 又得重來, 我就維持解鎖狀態了. 方法可參考 <a href="https://dennys.github.io/zh-tw/202203/android-remove-root-magisk/" target="_blank" rel="noopener noreffer">https://dennys.github.io/zh-tw/202203/android-remove-root-magisk/</a></p>
</li>
</ol>
<h2 id="系統更新後如何處理">系統更新後如何處理?</h2>
<p>不用處理, 至少目前我的 Pixel 5 更新到 2022 年 5 月更新 (12.1.0 (SP2A.220505.002, May 2022) 時, 都不需要處理.</p>
<h2 id="wi-fi-密碼更新後如何處理">Wi-Fi 密碼更新後如何處理?</h2>
<ol>
<li>如果系統有更新過, 就得先用 Magisk 重新 patch 一次.</li>
<li>一樣要試著連線 (當然不會成功), 重點是把密碼寫進去.</li>
<li>然後再用 adb shell 跑一次上面的 sed 指令修改 WifiConfigStore.xml 即可.</li>
</ol>
<h2 id="後記">後記</h2>
<p>這個方法並不是把不要驗證 (Do Not Validate) 的設定加回去, 而是先嘗試連線一個要驗證的 Wi-Fi (當然這裡會失敗), 等他把設定檔存下來之後, 再進系統把憑證的設定改掉, 所以還是和 Android 10 以前不太一樣. 而且 <em><strong>每次連上一個新的要使用 EAP 的 Wi-Fi 基地台都要重新執行一次</strong></em> , 會比較麻煩.</p>
]]></description>
</item>
<item>
    <title>Android 移除 Root 和 Magisk</title>
    <link>https://dennys.github.io/202203/android-remove-root-magisk/</link>
    <pubDate>Fri, 25 Mar 2022 00:00:00 &#43;0800</pubDate>
    <author>Dennys</author>
    <guid>https://dennys.github.io/202203/android-remove-root-magisk/</guid>
    <description><![CDATA[<p><mark style="background-color:rgba(0,0,0,0);" class="has-inline-color has-vivid-red-color"><strong>注意: 系統刷機有一定的風險, 可能導致手機無法開機和失去保固, 資料還會被清空, 執行前請先三思!!!</strong></mark></p>
<p><strong><mark style="background-color:rgba(0,0,0,0);" class="has-inline-color has-luminous-vivid-amber-color">注意: 系統刷機有一定的風險, 可能導致手機無法開機和失去保固, 資料還會被清空, 執行前請先三思!!!</mark></strong></p>
<p><strong><mark style="background-color:rgba(0,0,0,0);" class="has-inline-color has-luminous-vivid-orange-color">注意: 系統刷機有一定的風險, 可能導致手機無法開機和失去保固, 資料還會被清空, 執行前請先三思!!!</mark></strong></p>
<p>======================================================</p>
<h2 id="需求">需求</h2>
<p>在上次這篇 <a href="http://localhost:1313/zh-tw/posts/202203/add-do-not-validate-android-11-peap-mschapv2-wifi/" target="_blank" rel="noopener noreffer">Android 11 如何不要驗證 Wi-Fi CA 憑證</a> 有說明如何修改系統設定檔, 修改完後, 其實就不需要 Root 了, 因此可以 UnRoot. 方法如下:</p>
<p>1. 將手機重開, 並同時按下 電源+音量下鍵進入 bootloader 模式</p>
<p>2. 用 fastboot 刷回原始的 boot.img</p>
<pre class="wp-block-code"><code>fastboot boot boot.img</code></pre>
<p>2.1 其實 Magisk 有這個功能刷回原始的 boot.img</p>
<p><a href="https://dennys.files.wordpress.com/2022/02/image-3.png"></a></p>
<p><a href="https://dennys.files.wordpress.com/2022/02/image-4.png"></a></p>
<p>2.2 但我實測按下還原原始映像檔是沒作用的, 所以只好自己刷</p>
<p><a href="https://dennys.files.wordpress.com/2022/02/image-5.png"></a></p>
<p>3. 刷回原來的 boot.img 之後, 絕大多數 App 都可以用了, 不過實測發現沒有移除 Magisk, 還是有某些 App 譬如 Costco 或國泰世華銀行無法使用, 所以最後還是把 Magisk 移除. 但手機還是維持在 Unlock 狀態.</p>
]]></description>
</item>
</channel>
</rss>
