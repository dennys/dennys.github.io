<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>Maven - Tag - Dennys Diary</title>
        <link>https://dennys.github.io/tags/maven/</link>
        <description>Maven - Tag - Dennys Diary</description>
        <generator>Hugo -- gohugo.io</generator><language>en</language><copyright>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</copyright><lastBuildDate>Fri, 30 Sep 2011 22:40:00 &#43;0800</lastBuildDate><atom:link href="https://dennys.github.io/tags/maven/" rel="self" type="application/rss+xml" /><item>
    <title>Maven 4 - Others</title>
    <link>https://dennys.github.io/201109/maven-4-others/</link>
    <pubDate>Fri, 30 Sep 2011 22:40:00 &#43;0800</pubDate>
    <author>Dennys</author>
    <guid>https://dennys.github.io/201109/maven-4-others/</guid>
    <description><![CDATA[<h2 id="package-source-code">Package source code</h2>
<p>在 multi module 的架構裡面, 因為都只有打包 .class 到 local repository 的 .jar 檔裡面. 因此在 Eclipse 裡面按 F3 是無法連結到 source code 的, 要使用 maven-source-plugin 把 source code 也打包到 local repository 才可以. 如果原始的檔名是 app-1.0.jar, 則 source 會被打包到 app-1.0-sources.jar goal 請使用 source:jar</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  &lt;build&gt;
</span></span><span class="line"><span class="cl">    &lt;plugins&gt;
</span></span><span class="line"><span class="cl">      &lt;!-- Attach sources to repository --&gt;
</span></span><span class="line"><span class="cl">      &lt;plugin&gt;
</span></span><span class="line"><span class="cl">        &lt;artifactId&gt;maven-source-plugin&lt;/artifactId&gt;
</span></span><span class="line"><span class="cl">        &lt;executions&gt;
</span></span><span class="line"><span class="cl">          &lt;execution&gt;
</span></span><span class="line"><span class="cl">            &lt;id&gt;attach-sources&lt;/id&gt;
</span></span><span class="line"><span class="cl">            &lt;phase&gt;verify&lt;/phase&gt;
</span></span><span class="line"><span class="cl">            &lt;goals&gt;
</span></span><span class="line"><span class="cl">              &lt;goal&gt;jar&lt;/goal&gt;
</span></span><span class="line"><span class="cl">            &lt;/goals&gt;
</span></span><span class="line"><span class="cl">          &lt;/execution&gt;
</span></span><span class="line"><span class="cl">        &lt;/executions&gt;
</span></span><span class="line"><span class="cl">      &lt;/plugin&gt;
</span></span><span class="line"><span class="cl">    &lt;/plugins&gt;
</span></span><span class="line"><span class="cl">  &lt;/build&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="參考">參考</h2>
<ol>
<li><a href="http://maven.apache.org/plugins/maven-source-plugin/jar-mojo.html" target="_blank" rel="noopener noreffer">http://maven.apache.org/plugins/maven-source-plugin/jar-mojo.html</a></li>
</ol>
]]></description>
</item>
<item>
    <title>Maven 3 - 打包 EJB, EAR</title>
    <link>https://dennys.github.io/201109/maven-3-ejb-ear/</link>
    <pubDate>Thu, 29 Sep 2011 10:37:00 &#43;0800</pubDate>
    <author>Dennys</author>
    <guid>https://dennys.github.io/201109/maven-3-ejb-ear/</guid>
    <description><![CDATA[<h2 id="ear-的打包">Ear 的打包</h2>
<p>Ear 的打包分成兩階段, 第一個打包各個 ejb, 第二是把各個 ejb 加上 library 打包成 ear. 打包 ejb 的部分相對簡單, 如下. 最後會打包出 app-ejb1.jar (依據 finalName 的設定) 這個 ejb 檔案.</p>
<h3 id="ejb-client">EJB Client</h3>
<p>generateClient 是指定要產生一個 app-ejb1-client.jar 的檔案, 不過如果只加 generateClient 而沒有任何其他參數, 預設是只會過濾某幾個 pattern 而已, 請再加上 clientIncludes, clientExcludes 來過濾. 詳情可參考</p>
<ol>
<li><a href="http://maven.apache.org/plugins/maven-ejb-plugin/examples/generating-ejb-client.html" target="_blank" rel="noopener noreffer">http://maven.apache.org/plugins/maven-ejb-plugin/examples/generating-ejb-client.html</a></li>
<li><a href="http://maven.apache.org/plugins/maven-ejb-plugin/examples/ejb-client-dependency.html" target="_blank" rel="noopener noreffer">http://maven.apache.org/plugins/maven-ejb-plugin/examples/ejb-client-dependency.html</a></li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> &lt;build&gt;
</span></span><span class="line"><span class="cl">    &lt;plugins&gt;
</span></span><span class="line"><span class="cl">      &lt;plugin&gt;
</span></span><span class="line"><span class="cl">        &lt;groupid&gt;org.apache.maven.plugins&lt;/groupid&gt;
</span></span><span class="line"><span class="cl">        &lt;artifactid&gt;maven-compiler-plugin&lt;/artifactid&gt;
</span></span><span class="line"><span class="cl">        &lt;version&gt;2.3.2&lt;/version&gt;
</span></span><span class="line"><span class="cl">        &lt;configuration&gt;
</span></span><span class="line"><span class="cl">          &lt;source&gt;&lt;/source&gt;1.6
</span></span><span class="line"><span class="cl">          &lt;target&gt;1.6&lt;/target&gt;
</span></span><span class="line"><span class="cl">        &lt;/configuration&gt;
</span></span><span class="line"><span class="cl">      &lt;/plugin&gt;
</span></span><span class="line"><span class="cl">      &lt;plugin&gt;
</span></span><span class="line"><span class="cl">        &lt;groupid&gt;org.apache.maven.plugins&lt;/groupid&gt;
</span></span><span class="line"><span class="cl">        &lt;artifactid&gt;maven-ejb-plugin&lt;/artifactid&gt;
</span></span><span class="line"><span class="cl">        &lt;version&gt;2.3&lt;/version&gt;
</span></span><span class="line"><span class="cl">        &lt;configuration&gt;
</span></span><span class="line"><span class="cl">          &lt;ejbversion&gt;2.1&lt;/ejbversion&gt;
</span></span><span class="line"><span class="cl">          
</span></span><span class="line"><span class="cl">          &lt;generateclient&gt;true&lt;/generateclient&gt;
</span></span><span class="line"><span class="cl">        &lt;/configuration&gt;
</span></span><span class="line"><span class="cl">      &lt;/plugin&gt;
</span></span><span class="line"><span class="cl">    &lt;/plugins&gt;
</span></span><span class="line"><span class="cl">    &lt;finalname&gt;app-ejb1&lt;/finalname&gt;
</span></span><span class="line"><span class="cl">  &lt;/build&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>打包 ear 檔的部分則要注意一下. 首先是要設定好 dependency 如下, 注意雖然上面打包的 ejb 其副檔名是 .jar, 但這裡的 type 必須設定成 ejb</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  &lt;dependencies&gt;
</span></span><span class="line"><span class="cl">    &lt;dependency&gt;
</span></span><span class="line"><span class="cl">        &lt;groupid&gt;com.yourcompany&lt;/groupid&gt;
</span></span><span class="line"><span class="cl">        &lt;artifactid&gt;app-ejb1&lt;/artifactid&gt;
</span></span><span class="line"><span class="cl">        &lt;version&gt;1.0&lt;/version&gt;
</span></span><span class="line"><span class="cl">        &lt;type&gt;ejb&lt;/type&gt;
</span></span><span class="line"><span class="cl">    &lt;/dependency&gt;
</span></span><span class="line"><span class="cl">    &lt;dependency&gt;
</span></span><span class="line"><span class="cl">        &lt;groupid&gt;com.yourcompany&lt;/groupid&gt;
</span></span><span class="line"><span class="cl">        &lt;artifactid&gt;app-ejb2&lt;/artifactid&gt;
</span></span><span class="line"><span class="cl">        &lt;version&gt;1.0&lt;/version&gt;
</span></span><span class="line"><span class="cl">        &lt;type&gt;ejb&lt;/type&gt;
</span></span><span class="line"><span class="cl">    &lt;/dependency&gt;
</span></span><span class="line"><span class="cl">  &lt;/dependencies&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>打包 ear 的設定要注意幾個地方:`</p>
<ol>
<li>雖然 dependency 已經有指定了, 但是 ejb 還是要在 ejbModule 的地方再指定一次, 不同的是, 這裡不用指定 version 和 type, 不過要指定 bundleFileName, 這個是 ejb 最後會使用的檔案名字.</li>
<li>請記得設定 defaultLibBundleDir, 這樣會把用到的 library 放到 APP-INF/lib (預設是通通放在跟目錄, 和 ejb 混在一起, 那就沒用了)</li>
<li>如果有特別的檔案要直接放進來, 可以用 jarModule`</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  &lt;build&gt;
</span></span><span class="line"><span class="cl">    &lt;finalname&gt;app-ear&lt;/finalname&gt;
</span></span><span class="line"><span class="cl">    &lt;plugins&gt;
</span></span><span class="line"><span class="cl">      &lt;plugin&gt;
</span></span><span class="line"><span class="cl">        &lt;groupid&gt;org.apache.maven.plugins&lt;/groupid&gt;
</span></span><span class="line"><span class="cl">        &lt;artifactid&gt;maven-ear-plugin&lt;/artifactid&gt;
</span></span><span class="line"><span class="cl">        &lt;version&gt;2.5&lt;/version&gt;
</span></span><span class="line"><span class="cl">        &lt;configuration&gt;
</span></span><span class="line"><span class="cl">          &lt;generateapplicationxml&gt;true&lt;/generateapplicationxml&gt;  
</span></span><span class="line"><span class="cl">          &lt;defaultlibbundledir&gt;APP-INF/lib&lt;/defaultlibbundledir&gt;
</span></span><span class="line"><span class="cl">          &lt;modules&gt; 
</span></span><span class="line"><span class="cl">            &lt;ejbmodule&gt; 
</span></span><span class="line"><span class="cl">              &lt;groupid&gt;com.yourcompany&lt;/groupid&gt; 
</span></span><span class="line"><span class="cl">              &lt;artifactid&gt;app-ejb1&lt;/artifactid&gt; 
</span></span><span class="line"><span class="cl">              &lt;bundlefilename&gt;app-ejb1.jar&lt;/bundlefilename&gt; 
</span></span><span class="line"><span class="cl">            &lt;/ejbmodule&gt;
</span></span><span class="line"><span class="cl">            &lt;ejbmodule&gt; 
</span></span><span class="line"><span class="cl">              &lt;groupid&gt;com.yourcompany&lt;/groupid&gt; 
</span></span><span class="line"><span class="cl">              &lt;artifactid&gt;app-ejb2&lt;/artifactid&gt; 
</span></span><span class="line"><span class="cl">              &lt;bundlefilename&gt;app-ejb2.jar&lt;/bundlefilename&gt; 
</span></span><span class="line"><span class="cl">            &lt;/ejbmodule&gt;
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">          &lt;/modules&gt; 
</span></span><span class="line"><span class="cl">        &lt;/configuration&gt;
</span></span><span class="line"><span class="cl">      &lt;/plugin&gt;
</span></span><span class="line"><span class="cl">    &lt;/plugins&gt;
</span></span><span class="line"><span class="cl">  &lt;/build&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="最後-app-ear-的結構如下">最後 app-ear 的結構如下</h3>
<p>├── app-ejb1.jar<br>
├── app-ejb2.jar<br>
└── WEB-INF<br>
└── lib<br>
├── log4j-xxxx.jar<br>
├── axis-xxxxjar<br>
└── jdbc-xxxx.jar</p>
<p>如果要把 war 也放進來, 使用 webModule 即可, 如下. 要注意的是, 原來的 war 裡面的 contextRoot 會失去作用, 如果要指定, 請在 webModule 裡面新增一個</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  &lt;modules&gt;
</span></span><span class="line"><span class="cl">    &lt;webmodule&gt;
</span></span><span class="line"><span class="cl">      &lt;groupid&gt;artifactGroupId&lt;/groupid&gt;
</span></span><span class="line"><span class="cl">      &lt;artifactid&gt;artifactId&lt;/artifactid&gt;
</span></span><span class="line"><span class="cl">      &lt;contextroot&gt;/custom-context-root&lt;/contextroot&gt;
</span></span><span class="line"><span class="cl">    &lt;/webmodule&gt;
</span></span><span class="line"><span class="cl">  &lt;/modules&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>目前的 ear 並沒有把 war 打包進去, 如果要打包也很簡單, 在 ear 的 pom 加上一段 warModule 就可以了. 基本上沒有什麼問題, 可以改進的地方只有, 如果 ear 和 war 有共用的 .jar 檔, 那就會重複打包. 可參考 <a href="http://www.blogger.com/%5C%22http://maven.apache.org/plugins/maven-war-plugin/examples/skinny-wars.html%5C%22" target="_blank" rel="noopener noreffer">Creating Skinny WARs</a></p>
<h2 id="注意">注意</h2>
<ol>
<li>如果有使用 JPA, 而這個 JPA 是放在 EJB 或某個共用的 jar, 納在包成 EAR 的時候就要注意, 如果這個 jar 會同時出現在 war 的 WEB-INF/lib 以及 ear 的 APP-INF/lib, 那就會出現 duplicate persistence units with name 的錯誤. 解法:</li>
<li>ejb 會重複出現, 解法:無, 但似乎沒什麼影響</li>
</ol>
<h2 id="參考">參考</h2>
<ol>
<li><a href="http://maven.apache.org/plugins/maven-ejb-plugin/" target="_blank" rel="noopener noreffer">http://maven.apache.org/plugins/maven-ejb-plugin/</a></li>
<li><a href="http://maven.apache.org/plugins/maven-ear-plugin/" target="_blank" rel="noopener noreffer">http://maven.apache.org/plugins/maven-ear-plugin/</a></li>
</ol>
]]></description>
</item>
<item>
    <title>Maven 2 - 打包 war (含 applet)</title>
    <link>https://dennys.github.io/201109/maven-2-war-applet/</link>
    <pubDate>Wed, 28 Sep 2011 22:37:00 &#43;0800</pubDate>
    <author>Dennys</author>
    <guid>https://dennys.github.io/201109/maven-2-war-applet/</guid>
    <description><![CDATA[<p>在 Maven 裡面打包 war 應該是最簡單的了, 照著 Maven 的<a href="http://maven.apache.org/guides/introduction/introduction-to-the-standard-directory-layout.html/" target="_blank" rel="noopener noreffer">目錄結構</a>放好, 他就會自動去幫你把程式打包好. 唯一的問題是, 如果有用到 applet, 那就得另外處理了. 一個簡單的方法, 把 applet 設定成 war 的 dependency, 那就會把 applet 放到 WEB-INF/lib 下面, 不過這樣子似乎無法呼叫到 (這部分如果有解麻煩指正).</p>
<p>另外的方法是用 Maven 的 maven-dependency-plugin, 做法如下:</p>
<ol>
<li>先把 applet 打包好, 並且記得在使用 Maven 時加上 install 這個 goal, 這樣就會把打包好的 applet 放到 local repository 裡面去.</li>
<li>使用 maven-dependency-plugin 的 copy, 將 applet 放到指定的目錄. 這裡因為要放到 root, 所以指定的是 ${project.build.directory}/app-war-1.0. 後面的 &ldquo;app-war-1.0&rdquo; 請依照實際的專案修改.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  &lt;build&gt;
</span></span><span class="line"><span class="cl">    &lt;plugins&gt;
</span></span><span class="line"><span class="cl">      &lt;plugin&gt;
</span></span><span class="line"><span class="cl">        &lt;artifactid&gt;maven-dependency-plugin&lt;/artifactid&gt;
</span></span><span class="line"><span class="cl">        &lt;version&gt;2.2&lt;/version&gt;
</span></span><span class="line"><span class="cl">        &lt;executions&gt;
</span></span><span class="line"><span class="cl">          &lt;execution&gt;
</span></span><span class="line"><span class="cl">            &lt;id&gt;copy&lt;/id&gt;
</span></span><span class="line"><span class="cl">            &lt;phase&gt;prepare-package&lt;/phase&gt;
</span></span><span class="line"><span class="cl">            &lt;goals&gt;
</span></span><span class="line"><span class="cl">              &lt;goal&gt;copy&lt;/goal&gt;
</span></span><span class="line"><span class="cl">            &lt;/goals&gt;
</span></span><span class="line"><span class="cl">            &lt;configuration&gt;
</span></span><span class="line"><span class="cl">              &lt;artifactitems&gt;
</span></span><span class="line"><span class="cl">                &lt;artifactitem&gt;
</span></span><span class="line"><span class="cl">                  &lt;groupid&gt;com.yourcompany&lt;/groupid&gt;
</span></span><span class="line"><span class="cl">                  &lt;artifactid&gt;app-client&lt;/artifactid&gt;
</span></span><span class="line"><span class="cl">                  &lt;version&gt;1.0&lt;/version&gt;
</span></span><span class="line"><span class="cl">                  &lt;type&gt;jar&lt;/type&gt;
</span></span><span class="line"><span class="cl">                  &lt;overwrite&gt;true&lt;/overwrite&gt;
</span></span><span class="line"><span class="cl">                  &lt;destfilename&gt;app-client.jar&lt;/destfilename&gt;
</span></span><span class="line"><span class="cl">                &lt;/artifactitem&gt;
</span></span><span class="line"><span class="cl">              &lt;/artifactitems&gt;
</span></span><span class="line"><span class="cl">              &lt;outputdirectory&gt;${project.build.directory}/app-war-1.0&lt;/outputdirectory&gt;
</span></span><span class="line"><span class="cl">            &lt;/configuration&gt;
</span></span><span class="line"><span class="cl">          &lt;/execution&gt;
</span></span><span class="line"><span class="cl">        &lt;/executions&gt;
</span></span><span class="line"><span class="cl">      &lt;/plugin&gt;
</span></span><span class="line"><span class="cl">    &lt;/plugins&gt;
</span></span><span class="line"><span class="cl">  &lt;/build&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="reference">Reference</h2>
<p><a href="http://maven.apache.org/plugins/maven-dependency-plugin/" target="_blank" rel="noopener noreffer">http://maven.apache.org/plugins/maven-dependency-plugin/</a></p>
]]></description>
</item>
<item>
    <title>Maven 1 - 打包 Jar, Applet 並簽名 Sign</title>
    <link>https://dennys.github.io/201109/maven-1-jar-applet-sign/</link>
    <pubDate>Tue, 27 Sep 2011 20:49:00 &#43;0800</pubDate>
    <author>Dennys</author>
    <guid>https://dennys.github.io/201109/maven-1-jar-applet-sign/</guid>
    <description><![CDATA[<p>Maven 1 - 打包 Jar, Applet 並簽名 Sign&rsquo;,&lsquo;Applet 程式在 package 時有兩個重點, 一是要把所有用到的 jar 程式庫都包在一起, 因為 applet 不像 ear 或 war 有固定目錄可以放 *.jar. 二是如果需要用到 browser 機器的一些資源 (如印表機), 則必須經過簽名.</p>
<p>以下是要把 Applet 程式打包的寫法, 幾個重點:</p>
<ul>
<li>descriptorRef 使用 jar-with-dependencies: 會把用到的 class 都一起打包進最後的 jar 檔. 預設會打包到另一個檔案, 原來的名字如果是 app-client-1.0.jar, 則會打包成 app-client-1.0-jar-with-dependencies.jar</li>
<li>appendAssemblyId 設成 false, 這樣產生出來的 jar 檔案名稱才不會有 <em><strong>-with-dependencies</strong></em> 的字</li>
<li>phase 請指定 package, 這樣才會把需要的 class 都打包進去</li>
<li>goal 請使用 assembly:single (不指定也可以, 有 package 也會執行到這裡)</li>
<li>注意, maven-assembly-plugin 一定要用 2.2-beta-5, 用 2.2 或 2.2.1 都會有問題 (這感覺不太合理, 不過測試結果目前就是這樣, 或許是我哪裡弄錯了)</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;pre class=&#34;brush: xml&#34; title=&#34;Client 的 pom.xml (打包用)&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;build&gt;
</span></span><span class="line"><span class="cl">    &lt;plugins&gt;
</span></span><span class="line"><span class="cl">      &lt;plugin&gt;
</span></span><span class="line"><span class="cl">        &lt;groupid&gt;org.apache.maven.plugins&lt;/groupid&gt;
</span></span><span class="line"><span class="cl">        &lt;artifactid&gt;maven-compiler-plugin&lt;/artifactid&gt;
</span></span><span class="line"><span class="cl">        &lt;version&gt;2.3.2&lt;/version&gt;
</span></span><span class="line"><span class="cl">        &lt;configuration&gt;
</span></span><span class="line"><span class="cl">          &lt;source&gt;&lt;/source&gt;1.6
</span></span><span class="line"><span class="cl">          &lt;target&gt;1.6&lt;/target&gt;
</span></span><span class="line"><span class="cl">        &lt;/configuration&gt;
</span></span><span class="line"><span class="cl">      &lt;/plugin&gt;
</span></span><span class="line"><span class="cl">      &lt;plugin&gt;
</span></span><span class="line"><span class="cl">        &lt;artifactid&gt;maven-assembly-plugin&lt;/artifactid&gt;
</span></span><span class="line"><span class="cl">        &lt;version&gt;2.2-beta-5&lt;/version&gt;
</span></span><span class="line"><span class="cl">        &lt;configuration&gt;
</span></span><span class="line"><span class="cl">          &lt;descriptorrefs&gt;
</span></span><span class="line"><span class="cl">            &lt;descriptorref&gt;jar-with-dependencies&lt;/descriptorref&gt;
</span></span><span class="line"><span class="cl">          &lt;/descriptorrefs&gt;
</span></span><span class="line"><span class="cl">          &lt;finalname&gt;${project.build.finalName}&lt;/finalname&gt;
</span></span><span class="line"><span class="cl">          &lt;appendassemblyid&gt;false&lt;/appendassemblyid&gt;
</span></span><span class="line"><span class="cl">          &lt;archive&gt;
</span></span><span class="line"><span class="cl">            &lt;index&gt;true&lt;/index&gt;
</span></span><span class="line"><span class="cl">            &lt;manifest&gt;
</span></span><span class="line"><span class="cl">              &lt;adddefaultimplementationentries&gt;true&lt;/adddefaultimplementationentries&gt;
</span></span><span class="line"><span class="cl">            &lt;/manifest&gt;
</span></span><span class="line"><span class="cl">          &lt;/archive&gt;
</span></span><span class="line"><span class="cl">        &lt;/configuration&gt;
</span></span><span class="line"><span class="cl">        &lt;executions&gt;
</span></span><span class="line"><span class="cl">          &lt;execution&gt;
</span></span><span class="line"><span class="cl">            &lt;phase&gt;package&lt;/phase&gt;
</span></span><span class="line"><span class="cl">            &lt;goals&gt;
</span></span><span class="line"><span class="cl">              &lt;goal&gt;single&lt;/goal&gt;
</span></span><span class="line"><span class="cl">            &lt;/goals&gt;
</span></span><span class="line"><span class="cl">          &lt;/execution&gt;
</span></span><span class="line"><span class="cl">        &lt;/executions&gt;
</span></span><span class="line"><span class="cl">      &lt;/plugin&gt;
</span></span><span class="line"><span class="cl">    &lt;/plugins&gt;
</span></span><span class="line"><span class="cl">  &lt;/build&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>簽名的部分, 使用 maven-jarsigner-plugin 來做簽名即可.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">      &lt;plugin&gt;
</span></span><span class="line"><span class="cl">        &lt;groupid&gt;org.apache.maven.plugins&lt;/groupid&gt;
</span></span><span class="line"><span class="cl">        &lt;artifactid&gt;maven-jarsigner-plugin&lt;/artifactid&gt;
</span></span><span class="line"><span class="cl">        &lt;version&gt;1.2&lt;/version&gt;
</span></span><span class="line"><span class="cl">        &lt;executions&gt;
</span></span><span class="line"><span class="cl">          &lt;execution&gt;
</span></span><span class="line"><span class="cl">            &lt;id&gt;sign&lt;/id&gt;
</span></span><span class="line"><span class="cl">            &lt;goals&gt;
</span></span><span class="line"><span class="cl">              &lt;goal&gt;sign&lt;/goal&gt;
</span></span><span class="line"><span class="cl">            &lt;/goals&gt;
</span></span><span class="line"><span class="cl">          &lt;/execution&gt;
</span></span><span class="line"><span class="cl">        &lt;/executions&gt;
</span></span><span class="line"><span class="cl">        &lt;configuration&gt;
</span></span><span class="line"><span class="cl">          &lt;keystore&gt;${basedir}\\key\\xxxx.store&lt;/keystore&gt;
</span></span><span class="line"><span class="cl">          &lt;alias&gt;xxxxkey&lt;/alias&gt;
</span></span><span class="line"><span class="cl">          &lt;storepass&gt;yourpassword&lt;/storepass&gt;
</span></span><span class="line"><span class="cl">        &lt;/configuration&gt;
</span></span><span class="line"><span class="cl">      &lt;/plugin&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>實際上他會呼叫 jarsigner.exe 來做簽名的動作, 可以在 console 看到 log如下 (因為是 debug level, 所以要把 Maven 開到 debug mode 才看得到)```</p>
<p><code>[debug] Executing: cmd.exe /X /C \&quot;...\\jarsigner.exe -verify ...\\app-client-1.0.jar\&quot;</code></p>
<p>另外, 也可以使用 maven-jar-plugin, 效果和 maven-jarsigner-plugin 是一樣的. 但是在 jar-plugin 2.3 以後, <a href="http://maven.apache.org/plugins/maven-jar-plugin/sign-mojo.html/" target="_blank" rel="noopener noreffer">jar:sign 已經不被建議使用</a>, 請改用 jarsigner-plugin. 比較特別的是, jar-plugin 可以指定 signedjar 把簽名過的檔案放到其他目錄, 而 jarsigner-plugin 似乎沒有這個功能.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">      &lt;plugin&gt;
</span></span><span class="line"><span class="cl">        &lt;groupid&gt;org.apache.maven.plugins&lt;/groupid&gt;
</span></span><span class="line"><span class="cl">        &lt;artifactid&gt;maven-jar-plugin&lt;/artifactid&gt;
</span></span><span class="line"><span class="cl">        &lt;version&gt;2.3.1&lt;/version&gt;
</span></span><span class="line"><span class="cl">        &lt;executions&gt;
</span></span><span class="line"><span class="cl">          &lt;execution&gt;
</span></span><span class="line"><span class="cl">            &lt;goals&gt;
</span></span><span class="line"><span class="cl">              &lt;goal&gt;sign&lt;/goal&gt;
</span></span><span class="line"><span class="cl">            &lt;/goals&gt;
</span></span><span class="line"><span class="cl">          &lt;/execution&gt;
</span></span><span class="line"><span class="cl">        &lt;/executions&gt;
</span></span><span class="line"><span class="cl">        &lt;configuration&gt;
</span></span><span class="line"><span class="cl">          &lt;keystore&gt;${basedir}\\key\\xxxx.store&lt;/keystore&gt;
</span></span><span class="line"><span class="cl">          &lt;alias&gt;xxxxkey&lt;/alias&gt;
</span></span><span class="line"><span class="cl">          &lt;storepass&gt;yourpassword&lt;/storepass&gt;
</span></span><span class="line"><span class="cl">          
</span></span><span class="line"><span class="cl">          &lt;verify&gt;true&lt;/verify&gt;
</span></span><span class="line"><span class="cl">        &lt;/configuration&gt;
</span></span><span class="line"><span class="cl">      &lt;/plugin&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>喔, 講了那麼多, 都沒有提到 Jar&hellip; 其實 Applet 就是一個 Jar, 所以用上面 Applet 的方式就可以了. 差別在於 Jar 一般來說不需要簽名就是了.</p>
<h2 id="參考">參考</h2>
<ul>
<li><a href="http://maven.apache.org/plugins/maven-assembly-plugin/single-mojo.html" target="_blank" rel="noopener noreffer">http://maven.apache.org/plugins/maven-assembly-plugin/single-mojo.html</a></li>
<li><a href="http://maven.apache.org/plugins/maven-jar-plugin/" target="_blank" rel="noopener noreffer">http://maven.apache.org/plugins/maven-jar-plugin/</a></li>
<li><a href="http://maven.apache.org/plugins/maven-jarsigner-plugin/" target="_blank" rel="noopener noreffer">http://maven.apache.org/plugins/maven-jarsigner-plugin/</a></li>
<li><a href="http://stackoverflow.com/questions/2027753/how-to-deploy-applet-with-dependencies-jar-using-maven-and-sign-it" target="_blank" rel="noopener noreffer">http://stackoverflow.com/questions/2027753/how-to-deploy-applet-with-dependencies-jar-using-maven-and-sign-it</a></li>
</ul>
<h2 id="reference-for-assembly-for-standalone-jar">Reference for assembly for standalone jar</h2>
<ul>
<li><a href="http://stackoverflow.com/questions/1832853/is-it-possible-to-create-an-uber-jar-containing-the-project-classes-and-the-pro" target="_blank" rel="noopener noreffer">http://stackoverflow.com/questions/1832853/is-it-possible-to-create-an-uber-jar-containing-the-project-classes-and-the-pro</a></li>
<li><a href="http://blog.csdn.net/mozhenghua/archive/2010/06/14/5671133.asp" target="_blank" rel="noopener noreffer">http://blog.csdn.net/mozhenghua/archive/2010/06/14/5671133.asp</a></li>
</ul>
]]></description>
</item>
</channel>
</rss>
