# OpenVPN


[Asuswrt-Merlin](https://www.asuswrt-merlin.net/) 提供兩種 VPN server 工具, [PPTP](https://zh.m.wikipedia.org/zh-tw/%E9%BB%9E%E5%B0%8D%E9%BB%9E%E9%9A%A7%E9%81%93%E5%8D%94%E8%AD%B0) 和 [OpenVPN](https://zh.wikipedia.org/zh-tw/OpenVPN). PPTP 看起來已經被淘汰, 連 [iOS 10 以上都不支援 PPTP](https://support.apple.com/zh-tw/HT206844) 了.  因此目前看來是只能用 OpenVPN.

註1: Asuswrt 官方原版似乎有提供 PPTP, OpenVPN, IPSec VPN 這三種 VPN server, 可參考 https://www.asus.com/tw/support/FAQ/1044190/, 不過我已經刷 Asuswrt-Merlin 了, 就不測試了.

# 在 Asuswrt-Merlin 設定 OpenVPN

1. 進入 VPN 伺服器, 他可以建立兩個 OpenVPN server, 預設是 Server 1, 把它開啟. 我是只有要透過 VPN 來連內網, 所以設定 "LAN only". 如果需要使用者輸入帳號密碼, 請在最後面新增一個 username.

<!-- wp:image {"id":768,"width":654,"height":731,"sizeSlug":"large","linkDestination":"media"} -->
<figure class="wp-block-image size-large is-resized"><a href="https://dennys.files.wordpress.com/2022/06/image-10.png"><img src="https://dennys.files.wordpress.com/2022/06/image-10.png?w=758" alt="" class="wp-image-768" width="654" height="731"/></a></figure>
<!-- /wp:image -->

2. 下拉是選單這裡改選 "進階設定"

<!-- wp:image {"id":770,"width":534,"height":215,"sizeSlug":"large","linkDestination":"media"} -->
<figure class="wp-block-image size-large is-resized"><a href="https://dennys.files.wordpress.com/2022/06/image-11.png"><img src="https://dennys.files.wordpress.com/2022/06/image-11.png?w=760" alt="" class="wp-image-770" width="534" height="215"/></a></figure>
<!-- /wp:image -->

3. 進階設定如下, 如果希望 user 在 login 的時候要輸入帳號密碼, 那 "Username/Password Authentication 就需要選 "是".

<!-- wp:image {"id":773,"width":580,"height":476,"sizeSlug":"large","linkDestination":"media"} -->
<figure class="wp-block-image size-large is-resized"><a href="https://dennys.files.wordpress.com/2022/06/image-13.png"><img src="https://dennys.files.wordpress.com/2022/06/image-13.png?w=750" alt="" class="wp-image-773" width="580" height="476"/></a></figure>
<!-- /wp:image -->

4. 設定好後, 請再回到一般設定, 然後把設定值輸出到成一個 .opvn 檔案.

<!-- wp:image {"id":775,"sizeSlug":"large","linkDestination":"media"} -->
<figure class="wp-block-image size-large"><a href="https://dennys.files.wordpress.com/2022/06/image-14.png"><img src="https://dennys.files.wordpress.com/2022/06/image-14.png?w=758" alt="" class="wp-image-775"/></a></figure>
<!-- /wp:image -->

5. 要注意的是, Asuswrt-Merlin 產生的 client1.ovpn 裡面給的是 IP, 而如果你用的不是固定 IP, 而是使用 DDNS 之類的, 請記得修改裡面 remote 後面的 IP. 下面是 DDNS 的設定

<!-- wp:image {"id":785,"width":599,"height":377,"sizeSlug":"large","linkDestination":"media"} -->
<figure class="wp-block-image size-large is-resized"><a href="https://dennys.files.wordpress.com/2022/06/image-18.png"><img src="https://dennys.files.wordpress.com/2022/06/image-18.png?w=835" alt="" class="wp-image-785" width="599" height="377"/></a></figure>
<!-- /wp:image -->


以這個例子來講, 就要修改 .opvn 檔案的紅色部分

    # Config generated by Asuswrt-Merlin 386.5, requires OpenVPN 2.4.0 or newer.

    client
    dev tun
    proto udp
    remote test12345.asuscomm.com 1194
    resolv-retry infinite
    nobind
    float
    ncp-ciphers AES-128-GCM:AES-256-GCM:AES-128-CBC:AES-256-CBC
    comp-lzo adaptive
    keepalive 15 60
    remote-cert-tls server

# OpenVPN Client for Windows

<!-- wp:paragraph -->
<p>可從這裡下載: https://openvpn.net/community-downloads/, 裝好後選 import -&gt; 匯入設定檔, 把上面的檔案輸入進去, 就可以使用了.</p>
<!-- /wp:paragraph -->

# OpenVPN Client for Android

可從這裡下載: https://play.google.com/store/apps/details?id=net.openvpn.openvpn

連線成功後, 會出現這樣的通知, 可以直接在通知的地方暫停或斷線, 還滿方便的.

<!-- wp:image {"id":777,"sizeSlug":"large","linkDestination":"media"} -->
<figure class="wp-block-image size-large"><a href="https://dennys.files.wordpress.com/2022/06/image-15.png"><img src="https://dennys.files.wordpress.com/2022/06/image-15.png?w=366" alt="" class="wp-image-777"/></a></figure>
<!-- /wp:image -->

App 本身也會顯示使用的網路狀況

<!-- wp:image {"id":779,"width":304,"height":615,"sizeSlug":"large","linkDestination":"media"} -->
<figure class="wp-block-image size-large is-resized"><a href="https://dennys.files.wordpress.com/2022/06/image-16.png"><img src="https://dennys.files.wordpress.com/2022/06/image-16.png?w=390" alt="" class="wp-image-779" width="304" height="615"/></a></figure>
<!-- /wp:image -->

# OpenVPN Client for iOS, MacOS, Linux

可在<a href="https://openvpn.net/download-open-vpn/">這裡</a>下載其他平台的 client.

OpenVPN Server 上的連線狀況

從這裡可以看出他有幾個 client, 實際和VPN的IP, 從甚麼時候連的, 使用的資料量等等.

<!-- wp:image {"id":784,"sizeSlug":"large","linkDestination":"media"} -->
<figure class="wp-block-image size-large"><a href="https://dennys.files.wordpress.com/2022/06/image-17.png"><img src="https://dennys.files.wordpress.com/2022/06/image-17.png?w=757" alt="" class="wp-image-784"/></a></figure>
<!-- /wp:image -->

# SoftEther VPN

<a href="https://www.softether.org/">SoftEther VPN</a> 的官方文件說明他是 <em>An Open-Source Free ​Cross-platform Multi-protocol VPN Program</em>, 是看到有些人說他的 GUI 比 OpenVPN 好用, 但我用 OpenVPN 一切順利, 就懶得試了.

# Asuswrt OpenVPN 還不足的地方

感覺這還是比較陽春的 VPN server, 想到幾個不足的地方, 不過個人使用綽綽有餘了.
1. 沒有 timeout 機制, 連上來了就不會斷線.
1. 沒法限制 client 個數 (可能可以用 DHCP IP 數量來卡), Synology 的 OpenVPN 可以卡.
1. 管理介面沒法把人踢掉

